# プロジェクト仕様書: Real-time Audio Visualizer "Void"

## v1.1 追加機能要件

### 1. ビジュアル表現の強化

#### VE-01: グレインエフェクトのアニメーション化
- **概要**: 現在静的なグレイン（ノイズ）エフェクトを、時間経過で動的に変化させる。
- **仕様**:
    - ポストプロセッシングシェーダー内の乱数生成に時間（`time`）の要素を加え、毎フレーム異なるノイズパターンが生成されるようにする。
    - アニメーションの速度は、v1.1段階では固定値で実装する。将来的にはUIで調整可能にすることも検討する。

#### VE-02: ストロボ機能の実装
- **概要**: ビートに連動して、画面全体を瞬間的にフラッシュさせるストロボエフェクトを追加する。
- **仕様**:
    - **トリガー**: 低域 (Bass) のエネルギー量が、設定された閾値を超えた瞬間にエフェクトを発火させる。
    - **UI**:
        - ストロボ機能のON/OFFを切り替えるトグルスイッチをUIに追加する。
        - ストロボの明るさ（不透明度）を調整するスライダーをUIに追加する。最大値でも眩しすぎないよう、デフォルトは#FFFFFFの50%程度の明るさとする。
    - **実装**: 画面全体を覆う平面 (Plane) オブジェクトを用意し、トリガー時に短時間表示させて、即座にフェードアウトさせることで実現する。

#### VE-03: 描画エリアの全画面化
- **概要**: アスペクト比が横長なウィンドウサイズの場合に、ビジュアルが左右で途切れてしまう問題を修正する。
- **仕様**:
    - Three.jsのカメラ設定を見直し、ウィンドウのアスペエクト比に応じて描画範囲（視野角やオブジェクトの配置）が動的に調整され、常に幅100%で表示されるようにする。
    - `WavyLines`シーンなど、描画範囲の計算が重要なシーンへの影響を確認し、必要に応じて修正する。

---

### 2. UI/UXの改善

#### UX-01: UIパネル表示切り替えホットキー
- **概要**: キーボードショートカットでUIコントロールパネル（Tweakpane）の表示・非表示を切り替えられるようにする。
- **仕様**:
    - `U`キーを押下するたびに、UIパネルの表示状態をトグルさせる。
    - テキスト入力中など、意図しない場面で反応しないように制御する。

#### UX-02: シーン自動遷移のランダム化オプション
- **概要**: シーンの自動遷移モードに、現在のシーケンシャル（1→2→...→5）な順序に加え、ランダムな順序で遷移するオプションを追加する。
- **仕様**:
    - `Scene Transition`フォルダ内に「Random Order」のようなトグルスイッチを追加する。
    - ONの場合、次のシーンを現在アクティブなスロットの中から、現在のシーン以外をランダムに選択して遷移する。

#### UX-03: Empty（空）スロットの実装
- **概要**: 5つのシーンスロットに、何も表示しない「Empty」状態を割り当てられるようにする。
- **仕様**:
    - シーン選択のドロップダウンリストに「Empty」の選択肢を追加する。
    - スロットに「Empty」が割り当てられている場合、そのスロットではビジュアルが描画されない（背景色のみの状態になる）。
    - シーンの自動遷移が有効な場合、「Empty」が設定されているスロットはスキップして次の有効なスロットへ遷移する。

---

### 3. コンテンツの追加

#### SC-01: 新規ビジュアルシーンの追加
- **概要**: デフォルトで利用可能なビジュアルシーンを新たに追加し、表現のバリエーションを増やす。
- **仕様**: デザインコンセプト（ミニマル、クール、抽象的）に沿った、以下の5シーンを新規に実装する。

#### シーン4: Infinite Tunnel
- **概要**: 画面奥に向かって無限に続くワイヤーフレームのトンネル。音楽の疾走感を表現する。
- **低域 (Bass)**: ビートに合わせてトンネルの半径が一瞬拡大する。
- **中域 (Mid)**: トンネルを突き進むスピードが変化する。
- **高域 (Treble)**: ワイヤーフレームに歪みやグリッチ（ねじれ）を加える。

#### シーン5: Rotating Rings
- **概要**: レコード盤をイメージした、複数の同心円がそれぞれ回転する。
- **低域 (Bass)**: 円の線の太さが脈動するように変化する。
- **中域 (Mid)**: 各円の回転速度や回転方向が変化する。
- **高域 (Treble)**: 円周上にノイズやギザギザした乱れを加える。

#### シーン6: Warping Grid
- **概要**: 画面全体に広がるグリッド（格子）が、回転しながら拡大・縮小を繰り返す。
- **低域 (Bass)**: ビートに合わせてグリッド全体が拡大・縮小する。
- **中域 (Mid)**: グリッドの回転速度が変化する。
- **高域 (Treble)**: 格子の交点がランダムに明滅する。

#### シーン7: Pixel Swarm (※挑戦的実装)
- **概要**: ピクセルで構成された生命体のような群れが、画面内をうごめく。
- **低域 (Bass)**: ピクセル（パーティクル）の数が増減したり、群れが分裂したりするきっかけとなる。
- **中域 (Mid)**: 群れ全体の移動速度や動きの滑らかさが変化する。
- **高域 (Treble)**: 各ピクセルの色が明滅したり、ランダムに動いたりする。

#### シーン8: Noise Smoke (※挑戦的実装)
- **概要**: シェーダーを用いて生成される、ノイズで構成された煙のような不定形なビジュアル。
- **低域 (Bass)**: 煙全体の密度や広がりが変化する。
- **中域 (Mid)**: 煙が渦を巻く速度が変化する。
- **高域 (Treble)**: 煙を構成するノイズの粒子感を変化させる。